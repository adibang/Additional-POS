<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Barcode Generator</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
</head>
<body>
    <!-- ==================== HEADER ==================== -->
    <header class="app-header">
        <div class="header-content">
            <div class="app-title">
                <div class="icon-container">
                    <svg class="icon box-icon icon-primary" viewBox="0 0 24 24">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                        <line x1="12" y1="22.08" x2="12" y2="12"/>
                    </svg>
                </div>
                <span>POS Barcode Generator</span>
            </div>
            <div class="header-actions">
                <div class="printer-led-container">
                    <div class="printer-led disconnected" id="printer-led"></div>
                    <div class="printer-status-text" id="printer-status-text">Printer Offline</div>
                </div>
                <button onclick="showSettingsModal()">
                    <svg class="icon settings-icon icon-primary" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    Settings
                </button>
            </div>
        </div>
    </header>

    <!-- ==================== LOADING OVERLAY ==================== -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div style="margin-top: 20px; color: #006B54; font-weight: 600;">Memuat aplikasi...</div>
    </div>

    <!-- ==================== ERROR STATE ==================== -->
    <div id="error-state" class="error-state">
        <svg class="icon" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <h3>Gagal memuat aplikasi</h3>
        <p id="error-message"></p>
        <button class="retry-button" onclick="retryAppLoad()">
            <svg class="icon icon-sm" viewBox="0 0 24 24">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </svg>
            Coba Lagi
        </button>
    </div>

    <!-- ==================== STATIC SEARCH AND CATEGORY CONTAINER ==================== -->
    <div class="sticky-search-category-container">
        <!-- Search Bar -->
        <div class="search-container">
            <input type="text" id="product-search" class="search-input" placeholder="Cari produk berdasarkan nama atau kode...">
        </div>
        
        <!-- Category Dropdown Button (Visible on Mobile) -->
        <div class="category-dropdown-container">
            <button class="category-dropdown-button" id="category-dropdown-button">
                <span id="category-dropdown-label">Semua Produk</span>
                <svg class="icon icon-sm category-dropdown-icon" viewBox="0 0 24 24" style="color:#006B54;">
                    <path d="M6 9l6 6 6-6"/>
                </svg>
            </button>
        </div>
        
        <!-- Category Switcher (Visible on Desktop) -->
        <div class="category-switcher">
            <button class="category-toggle-btn active" onclick="showCategoryTabs()">
                <svg class="icon icon-sm" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <line x1="9" y1="9" x2="15" y2="15"/>
                    <line x1="15" y1="9" x2="9" y2="15"/>
                </svg>
                Pilih Tab
            </button>
            <button class="category-toggle-btn" onclick="showCategoryDropdown()">
                <svg class="icon icon-sm" viewBox="0 0 24 24">
                    <path d="M6 9l6 6 6-6"/>
                </svg>
                Pilih Dropdown
            </button>
        </div>
    </div>

    <!-- ==================== MAIN CONTENT ==================== -->
    <main class="main-content">
        <!-- Category Modal -->
        <div class="category-modal-overlay" id="category-modal">
            <div class="category-modal">
                <div class="category-modal-header">
                    <span>Pilih Kategori</span>
                    <button class="category-modal-close" onclick="closeCategoryModal()">Ã—</button>
                </div>
                <div class="category-modal-list" id="category-modal-list">
                    <!-- Categories will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Category Tabs -->
        <div class="category-tabs" id="category-tabs">
            <!-- Categories will be loaded here -->
        </div>
        
        <!-- Products Grid -->
        <div class="products-grid" id="products-grid">
            <!-- Products will be loaded here -->
        </div>
    </main>

    <!-- ==================== WEIGHT INPUT MODAL ==================== -->
    <div class="modal-overlay" id="weight-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <svg class="icon weight-icon icon-primary" viewBox="0 0 24 24">
                        <path d="M3 6h18"/>
                        <path d="M3 10h18"/>
                        <path d="M12 6v8"/>
                        <path d="M12 14v4"/>
                        <path d="M7 18h10"/>
                    </svg>
                    Input Berat
                </h2>
            </div>
            <div class="modal-body">
                <!-- Product Info -->
                <div class="product-info-section" id="selected-product-info">
                    <!-- Product info will be loaded here -->
                </div>
                
                <!-- Display -->
                <div class="display-section">
                    <div class="display-row">
                        <span>PRODUK:</span>
                        <span id="display-product-code">-</span>
                    </div>
                    <div class="display-row">
                        <span>BERAT:</span>
                        <span id="display-weight">0</span> <span style="font-size:0.9em">gram</span>
                    </div>
                    <div class="display-row">
                        <span>BARCODE:</span>
                        <span id="display-barcode">-</span>
                    </div>
                </div>
                
                <!-- Weight Preset Buttons -->
                <div class="weight-preset-buttons" id="weight-preset-buttons">
                    <!-- Preset buttons will be loaded here -->
                </div>
                
                <!-- Function Row -->
                <div class="function-row">
                    <button id="clear-btn" class="function-btn" onclick="clearWeight()">
                        <svg class="icon icon-sm" viewBox="0 0 24 24">
                            <path d="M3 6h18"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        CLEAR
                    </button>
                    <button id="generate-btn" class="function-btn" onclick="generateBarcode()">
                        <svg class="icon icon-sm" viewBox="0 0 24 24">
                            <path d="M12 2v4"/>
                            <path d="m5 5 2 2"/>
                            <path d="M19 5l-2 2"/>
                            <path d="M2 12h4"/>
                            <path d="m5 19 2-2"/>
                            <path d="M22 12h-4"/>
                            <path d="m12 22-2-4h4l-2 4z"/>
                            <circle cx="12" cy="12" r="4"/>
                        </svg>
                        GENERATE
                    </button>
                    <button id="connect-btn" class="function-btn" onclick="togglePrinterConnection()">
                        <svg class="icon icon-sm" viewBox="0 0 24 24">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                        CONNECT
                    </button>
                </div>
                
                <!-- Number Buttons -->
                <div class="buttons">
                    <button onclick="appendNumber('7')">7</button>
                    <button onclick="appendNumber('8')">8</button>
                    <button onclick="appendNumber('9')">9</button>
                    <button onclick="appendNumber('4')">4</button>
                    <button onclick="appendNumber('5')">5</button>
                    <button onclick="appendNumber('6')">6</button>
                    <button onclick="appendNumber('1')">1</button>
                    <button onclick="appendNumber('2')">2</button>
                    <button onclick="appendNumber('3')">3</button>
                    <button onclick="appendNumber('0')">0</button>
                    <button onclick="appendNumber('00')">00</button>
                    <button class="backspace-btn" onclick="backspaceWeight()">
                        <svg class="icon icon-sm" viewBox="0 0 24 24">
                            <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/>
                            <line x1="18" y1="9" x2="12" y2="15"/>
                            <line x1="12" y1="9" x2="18" y2="15"/>
                        </svg>
                    </button>
                    <button class="print-btn function-btn" onclick="printBarcode()">
                        <svg class="icon icon-sm" viewBox="0 0 24 24">
                            <polyline points="6 9 6 2 18 2 18 9"/>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1-2 2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                            <rect x="6" y="14" width="12" height="8"/>
                        </svg>
                        PRINT
                    </button>
                </div>
                
                <!-- Barcode Preview -->
                <div class="barcode-preview">
                    <div style="font-weight:600;color:#333333;margin-bottom:10px;display:flex;align-items:center;justify-content:center;gap:8px;">
                        <svg class="icon" viewBox="0 0 24 24" style="width:16px;height:16px;color:#006B54;">
                            <path d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z"/>
                            <path d="M8 7V5"/>
                            <path d="M16 7V5"/>
                            <path d="M8 12h8"/>
                            <path d="M8 17h5"/>
                        </svg>
                        PREVIEW BARCODE
                    </div>
                    <div class="barcode-container">
                        <svg id="barcode-svg"></svg>
                    </div>
                    <div class="barcode-info" id="current-barcode">Klik GENERATE untuk membuat barcode</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== ADD/EDIT PRODUCT MODAL ==================== -->
    <div class="modal-overlay" id="product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="product-modal-title">
                    <svg class="icon icon-primary" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="16"/>
                        <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                    Tambah Produk
                </h2>
            </div>
            <div class="modal-body">
                <div id="product-form-content">
                    <!-- Form will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== SETTINGS MODAL ==================== -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <svg class="icon icon-primary settings-icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    Pengaturan
                </h2>
            </div>
            <div class="modal-body">
                <div id="settings-content">
                    <!-- Settings will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== CATEGORY CONTEXT MENU ==================== -->
    <div id="category-context-menu" class="category-context-menu" style="display:none;"></div>

    <!-- ==================== LONG PRESS INDICATOR ==================== -->
    <div id="long-press-indicator" class="long-press-indicator" style="display:none;">Tahan untuk edit/hapus</div>

    <!-- ==================== NOTIFICATION ==================== -->
    <div id="notification"></div>

    <script src="script.js"></script>
</body>
</html>
